# Data Model: Elementor Page Builder Extractor

**Feature**: 001-elementor-extractor
**Date**: 2025-11-13
**Purpose**: Define TypeScript interfaces for all Elementor entities extracted from WordPress

---

## Overview

This data model represents the structured output of the Elementor extractor. All interfaces follow TypeScript strict mode conventions and include Zod schemas for runtime validation.

---

## Core Entities

### ElementorPage

Represents a complete WordPress page built with Elementor.

```typescript
interface ElementorPage {
  // WordPress metadata
  id: number;                    // WordPress post ID
  title: string;                 // Page title
  url: string;                   // Page URL
  slug: string;                  // Page slug
  status: 'publish' | 'draft' | 'pending' | 'private';
  lastModified: string;          // ISO 8601 timestamp

  // Elementor metadata
  elementorVersion: string;      // e.g., "3.18.0"
  elementorProVersion?: string;  // Optional, if Pro installed
  editMode: 'builder' | 'disabled';
  templateType: 'page' | 'section' | 'widget';

  // Page structure
  sections: ElementorSection[];

  // Global settings for this page
  pageSettings: PageSettings;

  // Extraction metadata
  extractedAt: string;           // ISO 8601 timestamp
  extractorVersion: string;      // Extractor tool version
}
```

**Validation Rules**:
- `id` must be positive integer
- `url` must be valid HTTP(S) URL
- `lastModified` must be valid ISO 8601 date
- `sections` array must not be empty for valid Elementor pages
- `elementorVersion` must match semver pattern

**Relationships**:
- Has many `ElementorSection` (1:N)

---

### PageSettings

Global settings applied to the entire page.

```typescript
interface PageSettings {
  // Layout
  pageLayout: 'default' | 'elementor_header_footer' | 'elementor_canvas';
  contentWidth: number;          // In pixels

  // SEO (if Elementor controls it)
  metaTitle?: string;
  metaDescription?: string;

  // Custom CSS
  customCss?: string;

  // Color scheme (page-level overrides)
  colorScheme?: {
    primary?: string;
    secondary?: string;
    text?: string;
    accent?: string;
  };

  // Any other page-level settings
  [key: string]: any;
}
```

---

### ElementorSection

Top-level container in Elementor hierarchy.

```typescript
interface ElementorSection {
  id: string;                    // Unique section ID (generated by Elementor)
  elType: 'section';             // Always 'section' for sections

  // Layout settings
  contentPosition: 'default' | 'top' | 'middle' | 'bottom';
  stretchSection: 'no' | 'full-width' | 'stretch-section';
  heightType: 'default' | 'fit-to-screen' | 'min-height';
  customHeight?: number;         // In pixels, if heightType !== 'default'

  // Gap between columns
  gap: 'default' | 'no' | 'narrow' | 'extended' | 'wide' | 'wider';

  // Background
  background: BackgroundSettings;

  // Structure
  structure: string;             // e.g., "50_50" for 2 equal columns
  columns: ElementorColumn[];

  // Styling
  padding?: SpacingValue;
  margin?: SpacingValue;
  border?: BorderSettings;
  borderRadius?: BorderRadiusValue;
  boxShadow?: ShadowSettings;

  // Advanced
  cssClasses?: string;
  cssId?: string;
  zIndex?: number;

  // Responsive settings
  responsive?: {
    mobile?: Partial<Omit<ElementorSection, 'id' | 'elType' | 'columns' | 'responsive'>>;
    tablet?: Partial<Omit<ElementorSection, 'id' | 'elType' | 'columns' | 'responsive'>>;
  };
}
```

**Validation Rules**:
- `id` must be non-empty string
- `columns` array must contain at least 1 column
- `structure` must match number of columns (e.g., "33_33_33" = 3 columns)
- Responsive settings must not be recursive

**Relationships**:
- Belongs to `ElementorPage` (N:1)
- Has many `ElementorColumn` (1:N)

---

### ElementorColumn

Container within sections that holds widgets.

```typescript
interface ElementorColumn {
  id: string;                    // Unique column ID
  elType: 'column';              // Always 'column'

  // Layout
  width: number;                 // Percentage (0-100) or custom value
  widthUnit: '%' | 'px';

  // Content alignment
  contentPosition: 'default' | 'top' | 'center' | 'bottom';
  spaceBetween?: number;         // Gap between widgets in pixels

  // Background
  background: BackgroundSettings;

  // Structure
  widgets: ElementorWidget[];

  // Styling
  padding?: SpacingValue;
  margin?: SpacingValue;
  border?: BorderSettings;
  borderRadius?: BorderRadiusValue;

  // Advanced
  cssClasses?: string;
  cssId?: string;

  // Responsive settings
  responsive?: {
    mobile?: Partial<Omit<ElementorColumn, 'id' | 'elType' | 'widgets' | 'responsive'>>;
    tablet?: Partial<Omit<ElementorColumn, 'id' | 'elType' | 'widgets' | 'responsive'>>;
  };
}
```

**Validation Rules**:
- `id` must be non-empty string
- `width` must be 0-100 for percentage, positive for pixels
- `widgets` array can be empty (empty columns are valid)

**Relationships**:
- Belongs to `ElementorSection` (N:1)
- Has many `ElementorWidget` (1:N)

---

### ElementorWidget

Individual component on the page.

```typescript
interface ElementorWidget {
  id: string;                    // Unique widget ID
  elType: 'widget';              // Always 'widget'
  widgetType: string;            // e.g., 'heading', 'text-editor', 'image', 'button'

  // Content settings (widget-specific)
  content: WidgetContent;

  // Style settings
  style: WidgetStyle;

  // Advanced settings
  advanced: WidgetAdvanced;

  // Responsive overrides
  responsive?: {
    mobile?: Partial<Pick<ElementorWidget, 'style' | 'advanced'>>;
    tablet?: Partial<Pick<ElementorWidget, 'style' | 'advanced'>>;
  };
}
```

**Validation Rules**:
- `id` must be non-empty string
- `widgetType` must match known Elementor widget types (validated against registry)
- `content` structure varies by `widgetType`

**Relationships**:
- Belongs to `ElementorColumn` (N:1)
- Has one `WidgetStyle` (1:1)
- Has one `WidgetAdvanced` (1:1, which includes animations)

---

## Widget-Specific Content Models

### WidgetContent

Union type that varies based on `widgetType`. Examples:

```typescript
type WidgetContent =
  | HeadingContent
  | TextEditorContent
  | ImageContent
  | ButtonContent
  | FormContent  // Elementor Pro
  | SliderContent  // Elementor Pro
  | Record<string, any>;  // Fallback for unknown widget types

interface HeadingContent {
  title: string;
  htmlTag: 'h1' | 'h2' | 'h3' | 'h4' | 'h5' | 'h6' | 'div' | 'span' | 'p';
  link?: {
    url: string;
    isExternal: boolean;
    nofollow: boolean;
  };
}

interface TextEditorContent {
  editor: string;  // HTML content
  dropCap?: 'no' | 'yes';
  columnsCount?: number;
  columnGap?: number;
}

interface ImageContent {
  image: {
    url: string;
    id: number;  // WordPress media ID
    alt: string;
  };
  imageSize: 'thumbnail' | 'medium' | 'large' | 'full' | 'custom';
  caption?: string;
  link?: {
    url: string;
    isExternal: boolean;
    nofollow: boolean;
  };
  openLightbox: boolean;
}

interface ButtonContent {
  text: string;
  link: {
    url: string;
    isExternal: boolean;
    nofollow: boolean;
  };
  size: 'xs' | 'sm' | 'md' | 'lg' | 'xl';
  icon?: {
    value: string;  // Icon class or SVG
    library: 'solid' | 'regular' | 'brands' | 'custom';
  };
  iconAlign: 'left' | 'right';
}

// Elementor Pro widgets
interface FormContent {
  formFields: Array<{
    fieldType: 'text' | 'email' | 'textarea' | 'url' | 'tel' | 'select' | 'checkbox' | 'radio' | 'date' | 'time' | 'file' | 'number';
    label: string;
    placeholder?: string;
    required: boolean;
    fieldOptions?: string[];  // For select/radio/checkbox
  }>;
  submitButton: {
    text: string;
    size: 'xs' | 'sm' | 'md' | 'lg' | 'xl';
  };
  formActions: Array<{
    type: 'email' | 'redirect' | 'webhook' | 'mailchimp' | 'activecampaign';
    settings: Record<string, any>;
  }>;
}
```

---

## Style Models

### WidgetStyle

Style configuration for a widget.

```typescript
interface WidgetStyle {
  // Typography
  typography?: TypographySettings;

  // Colors
  color?: string;               // Text color
  backgroundColor?: string;

  // Spacing
  padding?: SpacingValue;
  margin?: SpacingValue;

  // Border
  border?: BorderSettings;
  borderRadius?: BorderRadiusValue;

  // Shadow
  boxShadow?: ShadowSettings;
  textShadow?: ShadowSettings;

  // Background (for widgets that support it)
  background?: BackgroundSettings;

  // Widget-specific styles
  [key: string]: any;

  // Global style references
  globalStyleRefs?: string[];   // e.g., ['primary-color', 'heading-font']
}
```

---

### TypographySettings

```typescript
interface TypographySettings {
  fontFamily: string;
  fontSize: SizeValue;
  fontWeight: '100' | '200' | '300' | '400' | '500' | '600' | '700' | '800' | '900';
  fontStyle: 'normal' | 'italic' | 'oblique';
  textTransform: 'none' | 'uppercase' | 'lowercase' | 'capitalize';
  textDecoration: 'none' | 'underline' | 'line-through';
  lineHeight: SizeValue;
  letterSpacing: SizeValue;
  wordSpacing?: SizeValue;
}
```

---

### BackgroundSettings

```typescript
interface BackgroundSettings {
  type: 'none' | 'classic' | 'gradient' | 'video' | 'slideshow';

  // Classic (single color/image)
  color?: string;
  image?: {
    url: string;
    id: number;
  };
  position?: string;             // e.g., 'center center'
  attachment?: 'scroll' | 'fixed';
  repeat?: 'no-repeat' | 'repeat' | 'repeat-x' | 'repeat-y';
  size?: 'auto' | 'cover' | 'contain' | 'custom';

  // Gradient
  gradient?: {
    type: 'linear' | 'radial';
    angle?: number;              // For linear
    position?: string;           // For radial
    colors: Array<{
      color: string;
      position: number;          // 0-100 percentage
    }>;
  };

  // Video
  video?: {
    videoUrl?: string;
    startTime?: number;
    endTime?: number;
    autoplay: boolean;
    mute: boolean;
    loop: boolean;
    fallbackImage?: string;
  };

  // Overlay (for image/video backgrounds)
  overlay?: {
    enabled: boolean;
    color?: string;
    opacity?: number;
  };
}
```

---

### BorderSettings

```typescript
interface BorderSettings {
  type: 'none' | 'solid' | 'double' | 'dotted' | 'dashed' | 'groove';
  width?: SpacingValue;          // Can be all sides or individual
  color?: string;
}
```

---

### ShadowSettings

```typescript
interface ShadowSettings {
  horizontal: number;            // In pixels
  vertical: number;
  blur: number;
  spread: number;
  color: string;
  position: 'outline' | 'inset';
}
```

---

## Utility Types

### SpacingValue

Represents padding/margin with units.

```typescript
interface SpacingValue {
  top: number;
  right: number;
  bottom: number;
  left: number;
  unit: 'px' | 'em' | 'rem' | '%' | 'vh' | 'vw';
  isLinked: boolean;             // If true, all sides have same value
}
```

---

### SizeValue

Represents any size with units.

```typescript
interface SizeValue {
  size: number;
  unit: 'px' | 'em' | 'rem' | '%' | 'vh' | 'vw';
}
```

---

### BorderRadiusValue

```typescript
interface BorderRadiusValue {
  topLeft: number;
  topRight: number;
  bottomRight: number;
  bottomLeft: number;
  unit: 'px' | 'em' | 'rem' | '%';
  isLinked: boolean;
}
```

---

## Advanced Settings Models

### WidgetAdvanced

Advanced settings including animations and custom attributes.

```typescript
interface WidgetAdvanced {
  // Positioning
  position?: 'default' | 'absolute' | 'fixed';
  offset?: {
    x: SizeValue;
    y: SizeValue;
  };
  zIndex?: number;

  // Animations (entrance animations)
  animation?: WidgetAnimation;

  // Visibility
  conditionalDisplay?: ConditionalDisplay;

  // Custom attributes
  cssClasses?: string;
  cssId?: string;
  customAttributes?: Array<{
    key: string;
    value: string;
  }>;

  // Scrolling effects (Elementor Pro)
  scrollingEffects?: {
    vertical?: {
      translateY?: { from: number; to: number };
      opacity?: { from: number; to: number };
      blur?: { from: number; to: number };
      scale?: { from: number; to: number };
    };
    horizontal?: {
      translateX?: { from: number; to: number };
    };
    transparency?: {
      opacity?: { from: number; to: number };
    };
  };
}
```

---

### WidgetAnimation

Animation configuration.

```typescript
interface WidgetAnimation {
  type: AnimationType;
  duration: number;              // In milliseconds
  delay: number;                 // In milliseconds
  easing?: EasingFunction;
  trigger: 'viewport' | 'page-load' | 'hover' | 'click';
}

type AnimationType =
  // Fade animations
  | 'fadeIn' | 'fadeInUp' | 'fadeInDown' | 'fadeInLeft' | 'fadeInRight'
  // Zoom animations
  | 'zoomIn' | 'zoomInUp' | 'zoomInDown' | 'zoomInLeft' | 'zoomInRight'
  // Bounce animations
  | 'bounceIn' | 'bounceInUp' | 'bounceInDown' | 'bounceInLeft' | 'bounceInRight'
  // Slide animations
  | 'slideInUp' | 'slideInDown' | 'slideInLeft' | 'slideInRight'
  // Other
  | 'rotateIn' | 'lightSpeedIn' | 'rollIn' | 'flipInX' | 'flipInY';

type EasingFunction =
  | 'linear' | 'ease' | 'ease-in' | 'ease-out' | 'ease-in-out'
  | 'cubic-bezier(n,n,n,n)';  // Custom cubic bezier
```

---

### ConditionalDisplay

Rules for conditional widget visibility.

```typescript
interface ConditionalDisplay {
  enabled: boolean;
  conditions: Array<{
    type: 'device' | 'user-role' | 'custom';
    operator: 'is' | 'is-not' | 'contains' | 'starts-with' | 'ends-with';
    value: string | string[];
  }>;
  logic: 'and' | 'or';           // How to combine multiple conditions
}
```

---

## Global Styles Model

### GlobalStyle

Reusable style definition from Elementor theme kit.

```typescript
interface GlobalStyle {
  id: string;                    // e.g., 'primary-color', 'heading-font'
  type: 'color' | 'typography' | 'button';
  name: string;                  // Human-readable name

  // Color
  value?: string;                // Hex color value

  // Typography
  typography?: TypographySettings;

  // Button
  button?: {
    typography: TypographySettings;
    background: BackgroundSettings;
    padding: SpacingValue;
    border: BorderSettings;
    borderRadius: BorderRadiusValue;
    boxShadow?: ShadowSettings;
    hover?: Partial<typeof button>;  // Hover state overrides
  };
}
```

---

## Extraction Metadata Model

### ExtractionReport

Output alongside extracted data for quality tracking.

```typescript
interface ExtractionReport {
  // Summary
  startTime: string;             // ISO 8601
  endTime: string;
  duration: number;              // In milliseconds

  // Statistics
  stats: {
    totalPages: number;
    totalSections: number;
    totalColumns: number;
    totalWidgets: number;
    widgetTypeBreakdown: Record<string, number>;  // e.g., { 'heading': 15, 'image': 23 }
  };

  // Success/failure tracking
  results: {
    successfulWidgets: number;
    failedWidgets: number;
    warnings: string[];
  };

  // Failed widget details
  failures: Array<{
    pageId: number;
    sectionId: string;
    columnId: string;
    widgetId: string;
    widgetType: string;
    error: string;
    stackTrace?: string;
    rawData: any;                // For debugging
  }>;

  // Validation results
  validation: {
    passed: boolean;
    completenessScore: number;   // 0-100 percentage
    issues: Array<{
      severity: 'critical' | 'warning' | 'info';
      location: string;          // e.g., 'page:123 > section:abc > widget:xyz'
      message: string;
    }>;
  };

  // Environment
  environment: {
    extractorVersion: string;
    nodeVersion: string;
    platform: string;
    wordPressVersion?: string;
    elementorVersion?: string;
    connector: 'rest-api' | 'wp-cli' | 'database';
  };
}
```

---

## State Transitions

### Widget Extraction State Machine

```typescript
type ExtractionState =
  | 'pending'      // Widget queued for extraction
  | 'extracting'   // Currently being processed
  | 'validating'   // Running validation checks
  | 'completed'    // Successfully extracted and validated
  | 'failed';      // Extraction or validation failed

interface WidgetExtractionState {
  widgetId: string;
  state: ExtractionState;
  startTime?: string;
  endTime?: string;
  error?: string;
}
```

---

## Zod Validation Schemas

All models above have corresponding Zod schemas for runtime validation:

```typescript
import { z } from 'zod';

// Example: ElementorPage schema
const ElementorPageSchema = z.object({
  id: z.number().int().positive(),
  title: z.string(),
  url: z.string().url(),
  slug: z.string(),
  status: z.enum(['publish', 'draft', 'pending', 'private']),
  lastModified: z.string().datetime(),
  elementorVersion: z.string().regex(/^\d+\.\d+\.\d+$/),
  elementorProVersion: z.string().regex(/^\d+\.\d+\.\d+$/).optional(),
  editMode: z.enum(['builder', 'disabled']),
  templateType: z.enum(['page', 'section', 'widget']),
  sections: z.array(ElementorSectionSchema),
  pageSettings: PageSettingsSchema,
  extractedAt: z.string().datetime(),
  extractorVersion: z.string(),
});

// All other schemas follow similar pattern
// See implementation files for complete schema definitions
```

---

## Data Integrity Rules

1. **Referential Integrity**: All IDs referenced must exist in the data structure
2. **Hierarchy Validation**: Section → Column → Widget parent-child relationships must be valid
3. **Type Consistency**: Widget content must match declared widgetType schema
4. **Unit Consistency**: Size values must have valid unit combinations (no negative px, 0-100% for percentages)
5. **URL Validation**: All URLs (images, links, videos) must be well-formed
6. **Color Validation**: Colors must be valid CSS color values (hex, rgb, rgba, hsl, hsla, named)
7. **Responsive Consistency**: Responsive overrides must not create invalid states

---

## JSON Output Format

Final extraction output:

```json
{
  "version": "1.0.0",
  "extractedAt": "2025-11-13T10:30:00Z",
  "source": {
    "site": "https://example.com",
    "wordPressVersion": "6.4",
    "elementorVersion": "3.18.0"
  },
  "pages": [/* ElementorPage[] */],
  "globalStyles": [/* GlobalStyle[] */],
  "report": {/* ExtractionReport */}
}
```

---

## Notes

- All timestamps use ISO 8601 format with timezone
- All sizes default to `px` if unit not specified
- Colors are stored as original Elementor format (hex, rgba, global reference)
- Global style references are resolved at transformation phase (not extraction)
- Responsive settings use mobile-first approach (desktop → tablet → mobile inheritance)
